#
# NVIDIA BlueField-3 N6 Interface Firewall Configuration
# Production configuration for 5G Core N6 interface protection
#
# Copyright (c) 2024 NVIDIA Corporation
# Version: 2.6.0
#

# ================================================================
# Network Interface Configuration
# ================================================================

[network]
# Physical interface names (adjust based on your hardware)
uplink_interface = enp3s0f0          # Interface toward 5G UPF
downlink_interface = enp3s0f1        # Interface toward Data Network

# DOCA Flow port IDs (maps to physical interfaces)
uplink_port_id = 0                   # DOCA port for uplink
downlink_port_id = 1                 # DOCA port for downlink

# Interface IP configuration (optional - usually handled by netplan)
uplink_ip = 192.168.1.100/24         # IP address for uplink interface
downlink_ip = 192.168.2.100/24       # IP address for downlink interface
gateway = 192.168.2.1                # Default gateway
dns_servers = 8.8.8.8,1.1.1.1        # DNS servers

# VLAN configuration (if using VLANs)
enable_vlan = false                   # Enable VLAN tagging
uplink_vlan_id = 100                  # VLAN ID for uplink
downlink_vlan_id = 200               # VLAN ID for downlink

# ================================================================
# Firewall Rule Configuration
# ================================================================

[firewall]
# Default action for unmatched traffic
default_action = forward              # Options: forward, drop, log

# Rule processing mode
rule_processing_mode = hardware       # Options: hardware, software, hybrid

# Enable/disable specific rule types
enable_port_blocking = true           # TCP/UDP port blocking
enable_ip_blocking = true             # IP address blocking  
enable_rate_limiting = true           # Traffic rate limiting
enable_geo_blocking = false           # Geographic IP blocking
enable_dpi_rules = false              # Deep packet inspection

# Default blocked ports (comma-separated)
blocked_tcp_ports = 8001,8080,9001   # Block these TCP ports by default
blocked_udp_ports = 5060,5061        # Block these UDP ports by default

# Allowed port ranges (takes precedence over blocked ports)
allowed_tcp_ports = 80,443,22        # Always allow these TCP ports
allowed_udp_ports = 53,123            # Always allow these UDP ports

# Rate limiting defaults
default_rate_limit_pps = 10000        # Packets per second per flow
default_rate_limit_bps = 100000000    # Bits per second per flow (100 Mbps)
burst_size = 1000                     # Burst size in packets

# ================================================================
# DOCA Flow Hardware Configuration  
# ================================================================

[doca_flow]
# Flow processing configuration
mode = vnf,hws,isolated               # DOCA Flow mode (VNF with hardware steering)
pipe_queues = 16                      # Number of hardware queues
queue_depth = 1024                    # Queue depth per queue
aging_timeout = 300                   # Flow aging timeout (seconds)

# Hardware resource allocation
max_flow_entries = 65536              # Maximum hardware flow entries
max_counters = 4096                   # Hardware flow counters
max_meters = 2048                     # Hardware rate limit meters
max_shared_counters = 512             # Shared statistics counters
max_encap_actions = 256               # Encapsulation actions
max_modify_actions = 512              # Packet modification actions

# Memory configuration
hugepage_size = 2048                  # Hugepage size in KB (2MB)
hugepage_count = 1024                 # Number of hugepages to use
memory_channels = 4                   # Memory channels per socket

# ================================================================
# Performance and Processing Configuration
# ================================================================

[performance]
# CPU and threading
worker_threads = 4                    # Number of worker threads
control_thread_cpu = 0                # CPU for control thread
worker_thread_cpus = 4,5,6,7          # CPUs for worker threads (comma-separated)
use_cpu_affinity = true               # Enable CPU affinity

# Packet processing
rx_burst_size = 32                    # RX burst size
tx_burst_size = 32                    # TX burst size
prefetch_distance = 3                 # Cache prefetch distance
enable_packet_prefetch = true         # Enable packet prefetching

# Buffer management
mbuf_pool_size = 8192                 # Packet buffer pool size
mbuf_cache_size = 512                 # Per-core buffer cache
mbuf_data_size = 2048                 # Buffer data size

# Hardware offloading
enable_hw_checksum = true             # Hardware checksum offload
enable_hw_tso = true                  # Hardware TCP segmentation
enable_hw_lro = true                  # Hardware large receive offload
enable_hw_rss = true                  # Hardware receive side scaling

# ================================================================
# Logging and Monitoring Configuration
# ================================================================

[logging]
# Log levels: debug, info, warn, error, fatal
log_level = info                      # Default log level
log_to_stdout = false                 # Enable console logging
log_to_file = true                    # Enable file logging
log_to_syslog = true                  # Enable syslog

# Log file configuration
log_file = /var/log/n6-firewall/n6_firewall.log
log_file_max_size = 100MB             # Maximum log file size
log_file_max_files = 10               # Number of rotated files
log_file_rotation = daily             # Rotation frequency

# Syslog configuration
syslog_facility = local0              # Syslog facility
syslog_identity = n6-firewall         # Syslog identity
syslog_options = pid,cons,ndelay      # Syslog options

# Detailed logging options
log_dropped_packets = true            # Log dropped packets
log_allowed_packets = false           # Log allowed packets (verbose)
log_rate_limited_packets = true       # Log rate limited packets
log_configuration_changes = true      # Log config changes
log_performance_stats = true          # Log performance statistics

# ================================================================
# Statistics and Monitoring
# ================================================================

[monitoring]
# Statistics collection
stats_enabled = true                  # Enable statistics collection
stats_update_interval = 30            # Stats update interval (seconds)
stats_history_depth = 3600            # History depth (seconds)
stats_export_format = json            # Export format: json, csv, prometheus

# Prometheus metrics (if enabled)
prometheus_enabled = true             # Enable Prometheus metrics
prometheus_port = 9090                # Prometheus metrics port
prometheus_path = /metrics            # Metrics endpoint path

# Health monitoring
health_check_enabled = true           # Enable health checks
health_check_port = 8080              # Health check endpoint port
health_check_interval = 30            # Health check interval (seconds)
health_check_timeout = 5              # Health check timeout (seconds)

# Performance monitoring
monitor_cpu_usage = true              # Monitor CPU usage
monitor_memory_usage = true           # Monitor memory usage
monitor_network_stats = true          # Monitor network statistics
monitor_hardware_counters = true      # Monitor hardware counters

# Alerting thresholds
cpu_usage_threshold = 80              # CPU usage alert threshold (%)
memory_usage_threshold = 85           # Memory usage alert threshold (%)
packet_loss_threshold = 1             # Packet loss alert threshold (%)
latency_threshold = 1000              # Latency alert threshold (microseconds)

# ================================================================
# Security Configuration
# ================================================================

[security]
# Access control
enable_access_control = true          # Enable access control
admin_users = root,admin              # Admin users (comma-separated)
readonly_users = monitor,guest        # Read-only users (comma-separated)

# Authentication
enable_authentication = true          # Enable authentication
auth_method = pam                     # Authentication method: pam, ldap, local
auth_timeout = 300                    # Authentication timeout (seconds)

# Configuration security
config_file_permissions = 600         # Configuration file permissions
enable_config_encryption = false      # Encrypt sensitive config values
config_backup_enabled = true          # Enable configuration backups
config_backup_retention = 7           # Backup retention (days)

# Runtime security
enable_seccomp = true                 # Enable seccomp filtering
enable_capability_drop = true         # Drop unnecessary capabilities
enable_namespace_isolation = true     # Enable namespace isolation

# ================================================================
# Advanced N6 Interface Specific Configuration
# ================================================================

[n6_interface]
# 5G Core Network integration
upf_ip_range = 192.168.1.0/24         # Expected UPF IP range
dn_ip_range = 192.168.2.0/24          # Data Network IP range
core_network_id = core01              # 5G core network identifier

# GTP-U configuration (if processing GTP traffic)
enable_gtp_processing = true          # Enable GTP-U processing
gtp_port = 2152                       # GTP-U port number
gtp_version = 1                       # GTP version (1 or 2)
enable_gtp_echo = true                # Respond to GTP echo requests

# QoS configuration
enable_qos_marking = true             # Enable QoS marking
default_dscp = 0                      # Default DSCP value
voice_dscp = 46                       # Voice traffic DSCP (EF)
video_dscp = 34                       # Video traffic DSCP (AF41)
data_dscp = 0                         # Best effort data DSCP

# Traffic classification
enable_traffic_classification = true  # Enable traffic classification
classification_method = dpi           # Method: port, dpi, ml
enable_application_detection = true   # Detect applications

# Load balancing (if using multiple DPUs)
enable_load_balancing = false         # Enable load balancing
load_balance_method = hash            # Method: hash, round_robin, least_conn
load_balance_hash_fields = src_ip,dst_ip,src_port,dst_port

# ================================================================
# Backup and High Availability Configuration
# ================================================================

[high_availability]
# HA configuration
enable_ha = false                     # Enable high availability
ha_mode = active_passive              # HA mode: active_passive, active_active
ha_peer_ip = 192.168.100.2            # HA peer IP address
ha_heartbeat_interval = 1             # Heartbeat interval (seconds)
ha_failover_timeout = 5               # Failover timeout (seconds)

# State synchronization
enable_state_sync = false             # Enable state synchronization
state_sync_protocol = tcp             # Protocol: tcp, udp, multicast
state_sync_port = 9999                # State sync port

# Backup configuration
enable_config_backup = true           # Enable configuration backup
backup_location = /var/backups/n6-firewall/
backup_frequency = daily              # Backup frequency
backup_retention = 30                 # Backup retention (days)

# ================================================================
# Development and Testing Configuration
# ================================================================

[development]
# Debug settings (only for development)
enable_debug_mode = false             # Enable debug mode
debug_log_level = debug               # Debug log level
enable_packet_capture = false         # Enable packet capture
packet_capture_size = 1000            # Number of packets to capture
packet_capture_location = /tmp/pcap/

# Testing framework
enable_test_mode = false              # Enable test mode
synthetic_traffic_enabled = false     # Generate synthetic traffic
test_traffic_rate = 1000              # Test traffic rate (pps)
bypass_hardware_validation = false    # Bypass hardware checks (testing only)

# Performance profiling
enable_profiling = false              # Enable performance profiling
profiling_output = /tmp/profile.out   # Profiling output file
profiling_frequency = 10              # Profiling frequency (seconds)

# ================================================================
# End of Configuration
# ================================================================

# Configuration file syntax:
# - Lines starting with '#' are comments
# - Section headers are in [brackets]
# - Key-value pairs are separated by '='
# - Boolean values: true, false, yes, no, on, off, 1, 0
# - Numeric values support units: K, M, G (for bytes), s, ms, us (for time)
# - List values are comma-separated
# - Environment variable substitution: ${VAR_NAME}
# - Include other files: include /path/to/other.conf

# For more information, see:
# - NVIDIA DOCA Documentation: https://docs.nvidia.com/doca/
# - BlueField DPU Guide: https://docs.nvidia.com/bluefield-dpu/
# - N6 Interface Specification: 3GPP TS 23.501